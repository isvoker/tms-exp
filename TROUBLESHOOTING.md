# Устранение неполадок

## Проблемы с траекториями

### Ошибка: "getPositionAtDistance: пустой массив точек"

Эта ошибка возникает, когда анимация начинается до того, как траектория полностью сгенерирована.

**Решение:** Ошибка должна исчезнуть после обновления страницы. Все необходимые проверки уже добавлены в код.

### Траектории выходят за пределы экрана

**Причина:** Неправильный размер окна при инициализации.

**Решение:**
1. Перезапустите приложение
2. Убедитесь, что окно находится в полноэкранном режиме

## Проблемы с производительностью

### Низкая частота кадров (FPS)

**Причины:**
- Слабое оборудование
- Множество открытых приложений

**Решение:**
1. Закройте другие приложения
2. Убедитесь, что включено аппаратное ускорение в Chrome/Electron
3. Проверьте использование CPU/GPU в диспетчере задач

### Задержки при нажатии клавиш

**Причина:** Высокая нагрузка на систему

**Решение:**
1. Перезапустите приложение
2. Закройте другие программы

## Проблемы с логированием

### Логи не сохраняются

**Причина:** Недостаточно прав доступа к папке пользователя

**Решение:**
1. Запустите приложение с правами администратора (Windows)
2. Проверьте консоль браузера - логи сохраняются в localStorage как резервная копия
3. Проверьте путь к папке логов:
   - Windows: `%APPDATA%/tms-experiment/experiment-logs/`
   - Mac: `~/Library/Application Support/tms-experiment/experiment-logs/`
   - Linux: `~/.config/tms-experiment/experiment-logs/`

### Как экспортировать логи из localStorage

Откройте консоль разработчика (F12) и выполните:

```javascript
// Получить все ключи с логами
Object.keys(localStorage).filter(k => k.startsWith('experiment_'))

// Получить конкретный лог
localStorage.getItem('experiment_P001_1234567890')

// Сохранить в файл
const data = localStorage.getItem('experiment_P001_1234567890');
const blob = new Blob([data], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = 'experiment_log.json';
a.click();
```

## Проблемы с отображением

### Черный экран при запуске

**Причины:**
- Ошибка в консоли
- Проблемы с загрузкой ресурсов

**Решение:**
1. Откройте DevTools (F12)
2. Проверьте вкладку Console на наличие ошибок
3. Проверьте вкладку Network - все ли файлы загрузились
4. Перезагрузите страницу (Ctrl+R)

### Элементы отображаются неправильно

**Причина:** Кэш браузера

**Решение:**
1. Жесткая перезагрузка (Ctrl+Shift+R или Cmd+Shift+R)
2. Очистите кэш приложения через DevTools

### Шрифты или цвета выглядят странно

**Причина:** Изменения в CSS не применились

**Решение:**
1. Перезапустите приложение
2. Проверьте, что все CSS файлы загружены (DevTools → Network)

## Проблемы с Electron

### Приложение не запускается

**Проверьте:**
```bash
# Версия Node.js (должна быть 16+)
node --version

# Установлены ли зависимости
npm list electron

# Переустановка зависимостей
rm -rf node_modules package-lock.json
npm install
```

### Окно не открывается

**Решение:**
```bash
# Проверьте логи
npm run electron-dev

# Если видите ошибки порта:
# Измените PORT в package.json или закройте приложение на порту 3000
```

### Не работает полноэкранный режим

**Проверьте** `electron/main.js`:
```javascript
fullscreen: true  // должно быть установлено
```

## Проблемы с React

### "Cannot find module" ошибки

**Решение:**
```bash
npm install
```

### Изменения в коде не применяются

**Решение:**
1. Остановите dev server (Ctrl+C)
2. Удалите папку `build/`
3. Перезапустите: `npm run electron-dev`

### Hot Reload не работает

**Причина:** Настройки react-scripts

**Решение:**
- Перезапустите dev server
- Проверьте, что порт 3000 не заблокирован

## Отладка

### Включение подробного логирования

В `src/utils/trajectoryGenerator.js` раскомментируйте все `console.log`:

```javascript
generateSingleTrajectory(totalDistance, seed) {
  console.log('generateSingleTrajectory вызван:', { totalDistance, seed });
  // ... rest of code
}
```

### Проверка состояния эксперимента

Добавьте в консоль:
```javascript
// Проверить текущее состояние
console.log('Current state:', window.experimentState);
```

### Мониторинг производительности

В DevTools:
1. Вкладка Performance
2. Запустите запись
3. Выполните проблемное действие
4. Остановите запись
5. Анализируйте временную шкалу

## Известные ограничения

1. **Минимальное разрешение экрана:** 1280x720
2. **Поддерживаемые ОС:** Windows 10+, macOS 10.14+, Ubuntu 18.04+
3. **Браузеры для dev-режима:** Chrome, Edge (на базе Chromium)

## Получение помощи

Если проблема не решена:

1. Соберите информацию:
   - Версия Node.js (`node --version`)
   - Версия npm (`npm --version`)
   - Операционная система
   - Текст ошибки из консоли
   - Скриншот проблемы

2. Проверьте консоль на ошибки:
   - Откройте DevTools (F12)
   - Вкладка Console
   - Скопируйте все красные сообщения

3. Проверьте логи Electron:
   - Терминал, где запущено приложение
   - Скопируйте вывод

## Аварийное восстановление

### Полный сброс

```bash
# 1. Удалить все зависимости
rm -rf node_modules package-lock.json

# 2. Очистить кэш npm
npm cache clean --force

# 3. Переустановить
npm install

# 4. Перезапустить
npm run electron-dev
```

### Экспорт данных перед переустановкой

```javascript
// В консоли DevTools
const allData = Object.keys(localStorage)
  .filter(k => k.startsWith('experiment_'))
  .map(k => ({ key: k, value: localStorage.getItem(k) }));

console.log(JSON.stringify(allData, null, 2));
// Скопируйте вывод в текстовый файл
```
