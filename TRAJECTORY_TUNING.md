# Настройка траекторий

## Где настраивать

Файл: `src/utils/experimentConfig.js`

## Параметры траекторий

```javascript
export const TRAJECTORY_CONFIG = {
  MIN_DISTANCE: 400,        // Минимальная длина траектории (пикселей)
  SEGMENTS: { MIN: 4, MAX: 5 },  // Количество сегментов (поворотов)
  SMOOTHING_STEPS: 5,       // Плавность кривой (больше = плавнее)
  MARGIN: 100              // Отступ от краев экрана (пикселей)
};
```

## Решение типичных проблем

### Траектории слишком короткие

**Увеличьте `MIN_DISTANCE`:**
```javascript
MIN_DISTANCE: 600  // было 400
```

### Траектории слишком прямые

**Увеличьте количество сегментов:**
```javascript
SEGMENTS: { MIN: 5, MAX: 7 }  // было MIN: 4, MAX: 5
```

### Траектории слишком угловатые

**Увеличьте плавность:**
```javascript
SMOOTHING_STEPS: 8  // было 5
```

⚠️ **Внимание:** Большие значения SMOOTHING_STEPS могут снизить производительность!

### Траектории выходят за края экрана

**Увеличьте отступ:**
```javascript
MARGIN: 150  // было 100
```

### Траектории пересекают центр (фиксационную точку)

Траектории генерируются в 4 квадрантах экрана, чтобы избежать пересечения центра. Если все же пересекают:

1. Увеличьте `MIN_DISTANCE` - траектории станут длиннее и уйдут дальше от центра
2. Измените код генерации начальной точки (для продвинутых пользователей)

## Как работает генерация

### 1. Начальная точка
Выбирается случайный квадрант (из 4) и случайная позиция внутри него:
- Левый верхний
- Правый верхний
- Левый нижний
- Правый нижний

### 2. Генерация сегментов
От начальной точки строятся сегменты заданной длины с изменением угла:
- Угол меняется случайно в пределах ±45°
- При выходе за границы происходит "отражение"

### 3. Сглаживание (Catmull-Rom сплайн)
Между каждой парой точек добавляются промежуточные точки для плавной кривой.

## Рекомендуемые настройки

### Для коротких заданий (0.5 сек)
```javascript
MIN_DISTANCE: 300
SEGMENTS: { MIN: 3, MAX: 4 }
SMOOTHING_STEPS: 5
```

### Для средних заданий (1.6 сек)
```javascript
MIN_DISTANCE: 500
SEGMENTS: { MIN: 4, MAX: 5 }
SMOOTHING_STEPS: 5
```

### Для длинных заданий (2.9 сек)
```javascript
MIN_DISTANCE: 700
SEGMENTS: { MIN: 5, MAX: 6 }
SMOOTHING_STEPS: 6
```

## Динамическая настройка (продвинутый уровень)

Если хотите, чтобы траектории автоматически масштабировались в зависимости от длительности, измените в `trajectoryGenerator.js`:

```javascript
generateSingleTrajectory(totalDistance, seed) {
  // Динамически вычисляем минимальную дистанцию на основе totalDistance
  const minDistance = Math.max(
    totalDistance,
    totalDistance * 1.5  // Всегда на 50% длиннее расчетной
  );

  // Динамически вычисляем количество сегментов
  const numSegments = Math.floor(minDistance / 100); // 1 сегмент на 100 пикселей

  // ... rest of code
}
```

## Тестирование изменений

После изменения параметров:

1. Перезапустите приложение (`Ctrl+C` → `npm run electron-dev`)
2. Пройдите несколько трайлов каждого типа
3. Проверьте:
   - ✓ Траектории видны целиком
   - ✓ Нет разрывов
   - ✓ Плавность приемлема
   - ✓ Не пересекают центр
   - ✓ Не выходят за края

## Производительность

Зависимость от параметров:

| Параметр | Влияние на FPS | Рекомендация |
|----------|----------------|--------------|
| MIN_DISTANCE | Минимальное | Любое значение |
| SEGMENTS | Минимальное | До 10 |
| SMOOTHING_STEPS | **Высокое** | Не более 10 |
| MARGIN | Нет | Любое значение |

**Оптимальная конфигурация для 60 FPS:**
- SMOOTHING_STEPS: 5-7
- SEGMENTS.MAX: не более 8

## Отладка

Временно включите логирование в `trajectoryGenerator.js`:

```javascript
generateSingleTrajectory(totalDistance, seed) {
  console.log('Генерация:', { totalDistance, minDistance, numSegments });
  // ... код
  console.log('Точек до сглаживания:', points.length);
  // ... smoothTrajectory
  console.log('Точек после сглаживания:', smoothed.length);
}
```

Смотрите консоль для анализа:
- Сколько точек генерируется
- Какая итоговая длина траектории
- Сколько времени занимает генерация

## Сброс к значениям по умолчанию

```javascript
export const TRAJECTORY_CONFIG = {
  MIN_DISTANCE: 400,
  SEGMENTS: { MIN: 4, MAX: 5 },
  SMOOTHING_STEPS: 5,
  MARGIN: 100
};
```
