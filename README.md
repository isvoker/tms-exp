# TMS Experiment - Эксперимент по исследованию восприятия времени и движения

Приложение для проведения психологического эксперимента с четырьмя различными условиями, разработанное на React + Electron.

## Описание

Эксперимент состоит из 4 типов условий:

1. **Time to Collision** - предсказание длительности движения с окклюдером
2. **Контрольное условие** - остановка движения без окклюдера
3. **Обратный ход** - оценка времени прохождения пути в обратную сторону
4. **Воспроизведение длительности** - воспроизведение времени предъявления стимула

## Структура эксперимента

- **Тренировочный блок**: 60 попыток с обратной связью
- **Основная часть**: 8 блоков с рандомизированными попытками
- **Общее количество попыток**: ~300 в основной части
- После каждого блока: оценка длительности и опросник САН

## Установка и запуск

### Требования

- Node.js (версия 16 или выше)
- npm или yarn

### Установка зависимостей

```bash
npm install
```

### Запуск в режиме разработки

```bash
npm run electron-dev
```

Это запустит React dev server и откроет Electron приложение.

### Сборка для production

```bash
npm run build
npm run electron
```

### Создание установочного пакета

```bash
npm run package
```

## Основные функции

### Логирование

Все данные эксперимента автоматически сохраняются в JSON формате:
- Время реакции
- Позиции ответов
- Точность выполнения заданий
- Результаты опросников
- Метаданные блоков

Логи сохраняются в директорию `experiment-logs/` в папке пользовательских данных приложения.

### Управление

- **ПРОБЕЛ** - основная клавиша для всех ответов и переходов
- Приложение работает в полноэкранном режиме
- Курсор скрыт во время выполнения заданий

## Структура проекта

```
src/
├── components/
│   ├── ExperimentManager.js      # Главный контроллер эксперимента
│   ├── StartScreen.js             # Стартовый экран
│   ├── InstructionScreen.js       # Экран инструкций
│   ├── InterTrialScreen.js        # Экран между попытками
│   ├── BlockSummary.js            # Итоги блока
│   ├── trials/                    # Компоненты условий
│   │   ├── TimeToCollisionTrial.js
│   │   ├── ControlTrial.js
│   │   ├── ReverseTrial.js
│   │   └── DurationReproductionTrial.js
│   └── questionnaires/            # Опросники
│       ├── DurationEstimate.js
│       └── SANQuestionnaire.js
├── utils/
│   ├── experimentConfig.js        # Конфигурация эксперимента
│   ├── trajectoryGenerator.js     # Генератор траекторий
│   ├── trialGenerator.js          # Генератор трайлов
│   └── logger.js                  # Система логирования
└── App.js                         # Корневой компонент
```

## Параметры эксперимента

Все параметры настраиваются в файле `src/utils/experimentConfig.js`:

- Длительности стимулов: 0.5, 1.6, 2.9 сек
- Скорости движения: 200 и 400 точек/сек
- Количество повторений: 15 (основная часть), 5 (тренировка)
- Время фиксации: 900 мс
- Время обратной связи: 900 мс

## Траектории

Траектории генерируются автоматически для каждой длительности:
- 5 уникальных траекторий на каждую комбинацию параметров
- Плавные кривые из 4-5 сегментов с использованием Catmull-Rom сплайна
- Минимальная длина 400 пикселей (настраивается)
- Траектории не пересекают центральную фиксационную точку (4 квадранта)
- Траектории не выходят за границы экрана (отражение от границ)
- Полная непрерывность - нет разрывов или "прыжков"

### Настройка траекторий

См. файл `TRAJECTORY_TUNING.md` для детальной информации о настройке параметров траекторий.

## Система оценки

Точность рассчитывается как:
- **Для условий с движением**: расстояние от точки остановки до целевой зоны
- **Для воспроизведения длительности**: отклонение от целевой длительности

Баллы в конце блока показываются в процентах (0-100%).

## Обратная связь

В тренировочном блоке после каждой попытки показывается:
- Контур в месте фактической остановки
- Целевая позиция
- Пунктирная линия траектории (если применимо)

## Опросники

### Оценка длительности блока
Участник оценивает, сколько минут длился блок.

### САН (Самочувствие, Активность, Настроение)
16 вопросов по шкале 1-7 для оценки текущего состояния участника.

## Формат данных логов

```json
{
  "participantId": "P001",
  "sessionStartTime": 1234567890,
  "trials": [
    {
      "trialId": 1,
      "blockNumber": 1,
      "conditionType": "timeToCollision",
      "duration": 1600,
      "speed": 200,
      "response": {
        "accuracy": 0.85,
        "responseTime": 1543,
        "responsePosition": {"x": 450, "y": 300}
      },
      "events": [...]
    }
  ]
}
```

## Технические детали

- **Рендеринг**: HTML5 Canvas для плавной анимации
- **Точность времени**: performance.now() для высокой точности
- **Анимация**: requestAnimationFrame для 60 FPS
- **Рандомизация**: алгоритм Фишера-Йейтса

## Автор

Разработано для исследования восприятия времени и движения в контексте ТМС (транскраниальная магнитная стимуляция).

## Лицензия

Для исследовательских целей.
